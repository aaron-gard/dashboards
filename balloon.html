<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=no">
<title>Grace's Balloon Pop!</title>
<link href="https://fonts.googleapis.com/css2?family=Fredoka+One&display=swap" rel="stylesheet">
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'Fredoka One',cursive,system-ui;overflow:hidden;background:linear-gradient(180deg,#87CEEB 0%,#E0F6FF 60%,#C8E6C9 100%);height:100vh;cursor:none;user-select:none;-webkit-user-select:none}
canvas{display:block;width:100%;height:100%}
#cursor{position:fixed;width:44px;height:44px;pointer-events:none;z-index:1000;transform:translate(-50%,-50%)}
#cursor::before{content:'';position:absolute;inset:4px;border:4px solid #FF4757;border-radius:50%;box-shadow:0 0 12px rgba(255,71,87,.4)}
#cursor::after{content:'';position:absolute;top:50%;left:50%;width:8px;height:8px;background:#FF4757;border-radius:50%;transform:translate(-50%,-50%)}
#hud{position:fixed;top:16px;left:16px;z-index:100;background:rgba(255,255,255,.92);backdrop-filter:blur(10px);-webkit-backdrop-filter:blur(10px);padding:16px 24px;border-radius:20px;box-shadow:0 4px 20px rgba(0,0,0,.1);font-size:22px;color:#2C3E50;display:none}
.hud-row{display:flex;align-items:center;gap:8px;margin:4px 0}
.timer-text{color:#E74C3C;font-size:20px}
.score-num{color:#4D96FF;font-size:28px}
#speed-btn{background:#4D96FF;color:#fff;border:none;padding:8px 18px;border-radius:12px;font-family:inherit;font-size:16px;cursor:pointer;transition:transform .15s;margin-top:6px}
#speed-btn:active{transform:scale(.93)}
.screen{position:fixed;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center;z-index:200;transition:opacity .5s}
.screen.hidden{opacity:0;pointer-events:none}
#start-screen{background:linear-gradient(135deg,#667eea 0%,#764ba2 100%)}
#end-screen{background:rgba(0,0,0,.7);backdrop-filter:blur(6px);-webkit-backdrop-filter:blur(6px)}
.screen h1{font-size:clamp(32px,7vw,64px);color:#fff;text-shadow:3px 3px 6px rgba(0,0,0,.3);margin-bottom:8px}
.screen h2{font-size:clamp(18px,4vw,28px);color:rgba(255,255,255,.85);margin-bottom:32px;font-weight:400}
.big-btn{font-family:'Fredoka One',cursive;font-size:clamp(22px,5vw,36px);background:#FFD93D;color:#2C3E50;border:none;padding:18px 48px;border-radius:20px;cursor:pointer;box-shadow:0 6px 0 #D4A017,0 8px 20px rgba(0,0,0,.2);transition:transform .15s,box-shadow .15s}
.big-btn:hover{transform:translateY(-2px);box-shadow:0 8px 0 #D4A017,0 10px 24px rgba(0,0,0,.25)}
.big-btn:active{transform:translateY(2px);box-shadow:0 2px 0 #D4A017}
#final-score{font-size:clamp(48px,10vw,80px);color:#FFD93D;text-shadow:3px 3px 6px rgba(0,0,0,.3)}
#final-msg{font-size:clamp(16px,3vw,24px);color:rgba(255,255,255,.8);margin:8px 0 28px}
.time-pick{display:flex;gap:12px;margin-bottom:28px}
.time-btn{font-family:'Fredoka One',cursive;font-size:clamp(16px,3vw,22px);background:rgba(255,255,255,.15);color:rgba(255,255,255,.8);border:3px solid rgba(255,255,255,.25);padding:12px 24px;border-radius:14px;cursor:pointer;transition:all .2s}
.time-btn:hover{background:rgba(255,255,255,.25)}
.time-btn.sel{background:#FFD93D;color:#2C3E50;border-color:#FFD93D}
.combo-pop{position:fixed;pointer-events:none;z-index:150;font-size:32px;color:#FFD93D;text-shadow:2px 2px 4px rgba(0,0,0,.4);animation:comboUp .8s ease-out forwards}
@keyframes comboUp{0%{opacity:1;transform:translateY(0) scale(1)}100%{opacity:0;transform:translateY(-60px) scale(1.3)}}
</style>
</head>
<body>
<div class="screen" id="start-screen">
  <h1>üéà Grace's Balloon Pop! üéà</h1>
  <h2>Pop as many balloons as you can!</h2>
  <div class="time-pick">
    <button class="time-btn" data-t="30">30s</button>
    <button class="time-btn sel" data-t="60">60s</button>
    <button class="time-btn" data-t="90">90s</button>
    <button class="time-btn" data-t="0">‚àû</button>
  </div>
  <button class="big-btn" id="start-btn">Play!</button>
</div>
<div class="screen hidden" id="end-screen">
  <h1>üéâ Well Done Grace! üéâ</h1>
  <div id="final-score">0</div>
  <div id="final-msg">balloons popped!</div>
  <button class="big-btn" id="restart-btn">Play Again!</button>
</div>
<canvas id="c"></canvas>
<div id="cursor"></div>
<div id="hud">
  <div class="hud-row">üéà <span class="score-num" id="score">0</span></div>
  <div class="hud-row timer-text">‚è± <span id="timer">60</span>s</div>
  <button id="speed-btn">üê¢ Normal</button>
</div>
<script>
const canvas=document.getElementById('c'),ctx=canvas.getContext('2d'),cursorEl=document.getElementById('cursor');
let W,H;
function resize(){W=canvas.width=innerWidth;H=canvas.height=innerHeight}
resize();addEventListener('resize',resize);

// Audio
let audioCtx;
function initAudio(){audioCtx=new(window.AudioContext||window.webkitAudioContext)()}
function playPop(){
  if(!audioCtx)return;
  const o=audioCtx.createOscillator(),g=audioCtx.createGain();
  o.connect(g);g.connect(audioCtx.destination);o.type='triangle';
  o.frequency.setValueAtTime(800,audioCtx.currentTime);
  o.frequency.exponentialRampToValueAtTime(200,audioCtx.currentTime+.12);
  g.gain.setValueAtTime(.25,audioCtx.currentTime);
  g.gain.exponentialRampToValueAtTime(.001,audioCtx.currentTime+.15);
  o.start();o.stop(audioCtx.currentTime+.15);
}
function playCombo(){
  if(!audioCtx)return;
  const o=audioCtx.createOscillator(),g=audioCtx.createGain();
  o.connect(g);g.connect(audioCtx.destination);o.type='sine';
  o.frequency.setValueAtTime(523,audioCtx.currentTime);
  o.frequency.setValueAtTime(659,audioCtx.currentTime+.08);
  o.frequency.setValueAtTime(784,audioCtx.currentTime+.16);
  g.gain.setValueAtTime(.2,audioCtx.currentTime);
  g.gain.exponentialRampToValueAtTime(.001,audioCtx.currentTime+.3);
  o.start();o.stop(audioCtx.currentTime+.3);
}

// Characters
const CHARS=[
  {name:'Bluey',body:'#5B9BD5',snout:'#8AB8E6',type:'dog'},
  {name:'Bingo',body:'#FF9966',snout:'#FFB380',type:'dog'},
  {name:'Peppa',body:'#FF6B9D',snout:'#FFB3C1',nostril:'#C44569',type:'pig'},
  {name:'George',body:'#4D96FF',snout:'#6BB6FF',nostril:'#3498DB',type:'pig'},
  {name:'Dorothy',body:'#9B59B6',accent:'#E74C3C',type:'dino'},
  {name:'Emma',body:'#FFD93D',accent:'#F5A623',type:'wiggle'},
  {name:'Simon',body:'#E74C3C',accent:'#C0392B',type:'wiggle'},
  {name:'Lachy',body:'#9B59B6',accent:'#8E44AD',type:'wiggle'},
  {name:'Anthony',body:'#3498DB',accent:'#2980B9',type:'wiggle'},
];

let balloons=[],particles=[],score=0,timeLeft=60,gameDuration=60,running=false;
let timerInt=null,spawnInt=null;
let mouseX=0,mouseY=0,speedMult=1,speedIdx=0;
const SPEEDS=[{label:'üê¢ Normal',mult:1,col:'#4D96FF'},{label:'üêá Fast',mult:2,col:'#FF6B6B'},{label:'üöÄ Super!',mult:3.5,col:'#9B59B6'}];
let combo=0,lastPop=0,lastTime=0;

// Clouds
const clouds=[];
for(let i=0;i<5;i++)clouds.push({x:Math.random()*2000-200,y:40+Math.random()*180,w:120+Math.random()*100,spd:.15+Math.random()*.2});

function drawBg(dt){
  // Sun
  const grd=ctx.createRadialGradient(W-90,60,15,W-90,60,60);
  grd.addColorStop(0,'#FFF176');grd.addColorStop(.5,'#FFD93D');grd.addColorStop(1,'rgba(255,217,61,0)');
  ctx.fillStyle=grd;ctx.beginPath();ctx.arc(W-90,60,60,0,Math.PI*2);ctx.fill();
  // Clouds
  ctx.fillStyle='rgba(255,255,255,.7)';
  for(const c of clouds){
    c.x+=c.spd*60*dt;if(c.x>W+200)c.x=-200;
    const r=c.w*.25;
    ctx.beginPath();ctx.ellipse(c.x,c.y,c.w*.5,r,0,0,Math.PI*2);ctx.fill();
    ctx.beginPath();ctx.ellipse(c.x-c.w*.2,c.y-r*.6,r*1.1,r*.9,0,0,Math.PI*2);ctx.fill();
    ctx.beginPath();ctx.ellipse(c.x+c.w*.15,c.y-r*.5,r*1.3,r,0,0,Math.PI*2);ctx.fill();
  }
  // Grass
  ctx.fillStyle='#81C784';ctx.fillRect(0,H-30,W,30);
  ctx.fillStyle='#66BB6A';
  for(let x=0;x<W;x+=18){const h=8+Math.sin(x*.1)*6;ctx.beginPath();ctx.moveTo(x,H-30);ctx.quadraticCurveTo(x+9,H-30-h,x+18,H-30);ctx.fill()}
}

// Balloon
class Balloon{
  constructor(){this.spawn(true)}
  spawn(init){
    this.x=60+Math.random()*(W-120);this.y=init?H+50+Math.random()*200:H+80;
    this.size=38+Math.random()*22;this.char=CHARS[Math.floor(Math.random()*CHARS.length)];
    this.spd=.8+Math.random()*1.2;this.wP=Math.random()*Math.PI*2;
    this.wS=.015+Math.random()*.025;this.wA=.6+Math.random()*.8;this.nameA=0;
  }
  update(dt){
    this.y-=this.spd*speedMult*60*dt;this.wP+=this.wS*60*dt;this.x+=Math.sin(this.wP)*this.wA;
    const dx=mouseX-this.x,dy=mouseY-this.y,d=Math.sqrt(dx*dx+dy*dy);
    this.nameA+=(((d<this.size*2)?1:0)-this.nameA)*4*dt;
    if(this.y<-120)this.spawn(false);
  }
  draw(){
    const s=this.size,c=this.char;
    ctx.save();ctx.translate(this.x,this.y);
    // String
    ctx.strokeStyle='rgba(0,0,0,.2)';ctx.lineWidth=2;ctx.beginPath();ctx.moveTo(0,s*.7);
    const sw=Math.sin(this.wP*.5)*4;ctx.bezierCurveTo(sw,s*1.2,-sw,s*1.6,sw*.5,s*2);ctx.stroke();
    // Shadow
    ctx.fillStyle='rgba(0,0,0,.06)';ctx.beginPath();ctx.ellipse(3,3,s*.65,s*.6,0,0,Math.PI*2);ctx.fill();
    // Draw face
    if(c.type==='dog')this.drawDog(s,c);
    else if(c.type==='pig')this.drawPig(s,c);
    else if(c.type==='dino')this.drawDino(s,c);
    else this.drawWiggle(s,c);
    // Name
    if(this.nameA>.05){
      ctx.globalAlpha=this.nameA;ctx.fillStyle='rgba(0,0,0,.7)';
      ctx.font=`${Math.round(s*.3)}px 'Fredoka One',cursive`;ctx.textAlign='center';
      ctx.fillText(c.name,0,-s*.85);ctx.globalAlpha=1;
    }
    ctx.restore();
  }
  eyes(s,ex,ey,er,pr){
    for(const d of[-1,1]){
      ctx.fillStyle='#fff';ctx.beginPath();ctx.arc(d*s*ex,s*ey,s*er,0,Math.PI*2);ctx.fill();
      ctx.fillStyle='#222';ctx.beginPath();ctx.arc(d*s*ex,s*ey,s*pr,0,Math.PI*2);ctx.fill();
      ctx.fillStyle='#fff';ctx.beginPath();ctx.arc(d*s*ex+s*.04,s*ey-s*.03,s*pr*.35,0,Math.PI*2);ctx.fill();
    }
  }
  shine(s){ctx.fillStyle='rgba(255,255,255,.15)';ctx.beginPath();ctx.ellipse(-s*.2,-s*.25,s*.25,s*.2,-.3,0,Math.PI*2);ctx.fill()}
  drawDog(s,c){
    ctx.fillStyle=c.body;
    for(const d of[-1,1]){ctx.beginPath();ctx.ellipse(d*s*.55,-s*.35,s*.3,s*.55,d*-.3,0,Math.PI*2);ctx.fill()}
    ctx.beginPath();ctx.arc(0,0,s*.65,0,Math.PI*2);ctx.fill();this.shine(s);
    ctx.fillStyle=c.snout;ctx.beginPath();ctx.ellipse(0,s*.25,s*.38,s*.3,0,0,Math.PI*2);ctx.fill();
    this.eyes(s,.22,.08,.18,.09);
    ctx.fillStyle='#222';ctx.beginPath();ctx.ellipse(0,s*.18,s*.1,s*.08,0,0,Math.PI*2);ctx.fill();
    ctx.strokeStyle='#333';ctx.lineWidth=2;ctx.beginPath();ctx.arc(0,s*.22,s*.18,.2,Math.PI-.2);ctx.stroke();
  }
  drawPig(s,c){
    ctx.fillStyle=c.body;
    for(const d of[-1,1]){ctx.beginPath();ctx.moveTo(d*s*.4,-s*.45);ctx.lineTo(d*s*.65,-s*.85);ctx.lineTo(d*s*.25,-s*.55);ctx.closePath();ctx.fill()}
    ctx.beginPath();ctx.arc(0,0,s*.65,0,Math.PI*2);ctx.fill();this.shine(s);
    ctx.fillStyle=c.snout;ctx.beginPath();ctx.ellipse(0,s*.3,s*.4,s*.25,0,0,Math.PI*2);ctx.fill();
    ctx.fillStyle=c.nostril;
    for(const d of[-1,1]){ctx.beginPath();ctx.arc(d*s*.14,s*.3,s*.07,0,Math.PI*2);ctx.fill()}
    this.eyes(s,.2,.12,.16,.08);
    ctx.strokeStyle=c.nostril;ctx.lineWidth=2;ctx.beginPath();ctx.arc(0,s*.08,s*.22,.3,Math.PI-.3);ctx.stroke();
  }
  drawDino(s,c){
    ctx.fillStyle=c.accent;
    for(let i=-2;i<=2;i++){const bx=i*s*.18;ctx.beginPath();ctx.moveTo(bx-s*.08,-s*.55);ctx.lineTo(bx,-s*.85);ctx.lineTo(bx+s*.08,-s*.55);ctx.closePath();ctx.fill()}
    ctx.fillStyle=c.body;ctx.beginPath();ctx.arc(0,0,s*.65,0,Math.PI*2);ctx.fill();this.shine(s);
    ctx.fillStyle='rgba(255,255,255,.12)';ctx.beginPath();ctx.arc(s*.3,-s*.15,s*.1,0,Math.PI*2);ctx.fill();
    ctx.beginPath();ctx.arc(-s*.25,s*.2,s*.08,0,Math.PI*2);ctx.fill();
    this.eyes(s,.22,.08,.2,.1);
    ctx.strokeStyle='#333';ctx.lineWidth=2.5;ctx.beginPath();ctx.arc(0,s*.05,s*.3,.2,Math.PI-.2);ctx.stroke();
    ctx.fillStyle=c.accent;ctx.beginPath();ctx.arc(s*.45,-s*.45,s*.12,0,Math.PI*2);ctx.fill();
    ctx.beginPath();ctx.arc(s*.55,-s*.35,s*.1,0,Math.PI*2);ctx.fill();
  }
  drawWiggle(s,c){
    ctx.fillStyle=c.body;ctx.beginPath();ctx.arc(0,0,s*.6,0,Math.PI*2);ctx.fill();
    ctx.fillStyle='rgba(255,255,255,.2)';ctx.beginPath();ctx.ellipse(-s*.15,-s*.2,s*.2,s*.18,-.3,0,Math.PI*2);ctx.fill();
    ctx.fillStyle=c.accent||c.body;ctx.beginPath();ctx.ellipse(0,s*.55,s*.4,s*.25,0,Math.PI,Math.PI*2,true);ctx.fill();
    this.eyes(s,.2,.08,.18,.09);
    ctx.strokeStyle='#333';ctx.lineWidth=2.5;ctx.beginPath();ctx.arc(0,s*.05,s*.28,.3,Math.PI-.3);ctx.stroke();
  }
  hit(x,y){const dx=x-this.x,dy=y-this.y;return Math.sqrt(dx*dx+dy*dy)<this.size*.7}
}

// Particles
class Particle{
  constructor(x,y,col){
    this.x=x;this.y=y;this.vx=(Math.random()-.5)*12;this.vy=(Math.random()-.5)*12-3;
    this.life=1;this.col=col;this.sz=4+Math.random()*8;
    this.star=Math.random()<.4;this.rot=Math.random()*Math.PI*2;this.rotV=(Math.random()-.5)*8;
  }
  update(dt){this.x+=this.vx*60*dt;this.y+=this.vy*60*dt;this.vy+=.15*60*dt;this.rot+=this.rotV*dt;this.life-=1.5*dt}
  draw(){
    ctx.save();ctx.globalAlpha=Math.max(0,this.life);ctx.translate(this.x,this.y);ctx.rotate(this.rot);
    ctx.fillStyle=this.col;
    if(this.star){
      ctx.beginPath();
      for(let i=0;i<5;i++){const a=i*4*Math.PI/5-Math.PI/2;ctx[i?'lineTo':'moveTo'](Math.cos(a)*this.sz,Math.sin(a)*this.sz);const a2=a+2*Math.PI/5;ctx.lineTo(Math.cos(a2)*this.sz*.4,Math.sin(a2)*this.sz*.4)}
      ctx.closePath();ctx.fill();
    }else{ctx.beginPath();ctx.arc(0,0,this.sz,0,Math.PI*2);ctx.fill()}
    ctx.restore();
  }
}

function popAt(i){
  const b=balloons[i];
  const cols=['#FF6B9D','#FFD93D','#4D96FF','#6BCB77','#FF4757','#A29BFE',b.char.body];
  for(let j=0;j<25;j++)particles.push(new Particle(b.x,b.y,cols[Math.floor(Math.random()*cols.length)]));
  playPop();score++;document.getElementById('score').textContent=score;
  // Combo
  const now=performance.now();
  if(now-lastPop<600){combo++;if(combo>=3){playCombo();showCombo(b.x,b.y,combo)}}else combo=1;
  lastPop=now;
  balloons.splice(i,1);
}

function showCombo(x,y,n){
  const el=document.createElement('div');el.className='combo-pop';
  el.textContent=n+'x Combo! ‚ö°';el.style.left=x+'px';el.style.top=(y-40)+'px';
  document.body.appendChild(el);setTimeout(()=>el.remove(),900);
}

function checkHit(){
  for(let i=balloons.length-1;i>=0;i--){
    if(balloons[i].hit(mouseX,mouseY)){popAt(i);break}
  }
}

// Main loop
function frame(ts){
  requestAnimationFrame(frame);
  const dt=lastTime?Math.min((ts-lastTime)/1000,.05):0.016;
  lastTime=ts;
  ctx.clearRect(0,0,W,H);
  drawBg(dt);
  // Update & draw balloons
  for(const b of balloons){b.update(dt);b.draw()}
  // Particles
  for(let i=particles.length-1;i>=0;i--){
    particles[i].update(dt);particles[i].draw();
    if(particles[i].life<=0)particles.splice(i,1);
  }
}

function startGame(){
  initAudio();
  document.getElementById('start-screen').classList.add('hidden');
  document.getElementById('end-screen').classList.add('hidden');
  document.getElementById('hud').style.display='block';
  balloons=[];particles=[];score=0;timeLeft=gameDuration;combo=0;running=true;
  document.getElementById('score').textContent='0';
  const timerEl=document.getElementById('timer');
  if(gameDuration===0){timerEl.parentElement.style.display='none'}
  else{timerEl.parentElement.style.display='';timerEl.textContent=gameDuration}
  // Clear old intervals
  clearInterval(timerInt);clearInterval(spawnInt);
  // Spawn initial batch
  for(let i=0;i<6;i++)balloons.push(new Balloon());
  spawnInt=setInterval(()=>{if(running&&balloons.length<18)balloons.push(new Balloon())},700);
  if(gameDuration>0){
    timerInt=setInterval(()=>{
      timeLeft--;document.getElementById('timer').textContent=timeLeft;
      if(timeLeft<=0)endGame();
    },1000);
  }
}

function endGame(){
  running=false;clearInterval(timerInt);clearInterval(spawnInt);
  document.getElementById('final-score').textContent=score;
  document.getElementById('end-screen').classList.remove('hidden');
}

// Input
document.addEventListener('mousemove',e=>{
  mouseX=e.clientX;mouseY=e.clientY;
  cursorEl.style.left=mouseX+'px';cursorEl.style.top=mouseY+'px';
  if(running)checkHit();
});
document.addEventListener('touchmove',e=>{
  e.preventDefault();const t=e.touches[0];mouseX=t.clientX;mouseY=t.clientY;
  cursorEl.style.left=mouseX+'px';cursorEl.style.top=mouseY+'px';
  if(running)checkHit();
},{passive:false});
document.addEventListener('touchstart',e=>{
  const t=e.touches[0];mouseX=t.clientX;mouseY=t.clientY;
  cursorEl.style.left=mouseX+'px';cursorEl.style.top=mouseY+'px';
  if(running)checkHit();
},{passive:true});

// Speed toggle
document.getElementById('speed-btn').onclick=()=>{
  speedIdx=(speedIdx+1)%SPEEDS.length;
  speedMult=SPEEDS[speedIdx].mult;
  const btn=document.getElementById('speed-btn');
  btn.textContent=SPEEDS[speedIdx].label;btn.style.background=SPEEDS[speedIdx].col;
};

// Time picker
document.querySelectorAll('.time-btn').forEach(btn=>{
  btn.onclick=()=>{
    document.querySelectorAll('.time-btn').forEach(b=>b.classList.remove('sel'));
    btn.classList.add('sel');
    gameDuration=parseInt(btn.dataset.t);
  };
});

// Buttons
document.getElementById('start-btn').onclick=startGame;
document.getElementById('restart-btn').onclick=startGame;

requestAnimationFrame(frame);
</script>
</body>
</html>