<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=no">
<title>Bluey's Backyard Adventure</title>
<link href="https://fonts.googleapis.com/css2?family=Fredoka+One&display=swap" rel="stylesheet">
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{overflow:hidden;background:#87CEEB;font-family:'Fredoka One',cursive,system-ui}
canvas{display:block}
#title{position:fixed;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center;background:rgba(135,206,235,.85);z-index:100;transition:opacity .6s}
#title.hidden{opacity:0;pointer-events:none}
#title h1{font-size:clamp(28px,6vw,56px);color:#4A90D9;text-shadow:3px 3px 0 #fff,-1px -1px 0 #fff,1px -1px 0 #fff,-1px 1px 0 #fff;margin-bottom:8px}
#title h2{font-size:clamp(14px,3vw,22px);color:#E8734A;margin-bottom:32px}
#playBtn{font-family:'Fredoka One',cursive;font-size:clamp(20px,4vw,32px);background:#F5A623;color:#fff;border:none;border-radius:50px;padding:16px 48px;cursor:pointer;box-shadow:0 6px 0 #c9841a;transition:transform .15s,box-shadow .15s}
#playBtn:hover{transform:translateY(-2px);box-shadow:0 8px 0 #c9841a}
#playBtn:active{transform:translateY(2px);box-shadow:0 2px 0 #c9841a}
#hud{position:fixed;top:16px;left:16px;z-index:10;font-size:clamp(18px,3vw,28px);color:#fff;text-shadow:2px 2px 4px rgba(0,0,0,.5)}
#hud.hidden{display:none}
#msg{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);font-size:clamp(24px,5vw,48px);color:#F5A623;text-shadow:2px 2px 0 #fff;z-index:10;opacity:0;transition:opacity .3s;pointer-events:none}
#msg.show{opacity:1}
#touch-left{position:fixed;bottom:24px;left:24px;width:120px;height:120px;border-radius:50%;background:rgba(255,255,255,.2);border:3px solid rgba(255,255,255,.3);z-index:20;display:none;touch-action:none}
#touch-knob{position:absolute;width:50px;height:50px;border-radius:50%;background:rgba(255,255,255,.5);top:50%;left:50%;transform:translate(-50%,-50%);pointer-events:none}
#touch-jump{position:fixed;bottom:40px;right:24px;width:80px;height:80px;border-radius:50%;background:rgba(245,166,35,.4);border:3px solid rgba(245,166,35,.5);z-index:20;display:none;font-family:'Fredoka One',cursive;color:#fff;font-size:16px;line-height:80px;text-align:center;touch-action:none}
</style>
</head>
<body>
<div id="title"><h1>Bluey's Backyard Adventure</h1><h2>Move the mouse to steer! Collect all the bones!</h2><button id="playBtn" onclick="startGame()">Play!</button></div>
<div id="hud" class="hidden">&#x1F9B4; <span id="score">0</span> / <span id="total">20</span></div>
<div id="msg"></div>
<!-- touch: tap left/right side of screen to steer -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<script>
// --- GLOBALS ---
let scene,camera,renderer,clock,player,bingo,bones=[],collected=0,totalBones=20;
let keys={},velY=0,onGround=true,gameStarted=false;
let touchDir={x:0,y:0},touchJump=false;
const SPEED=8,JUMP=10,GRAV=25,BOUND=25;
let audioCtx;

function initAudio(){audioCtx=new(window.AudioContext||window.webkitAudioContext)()}
function playDing(){
  if(!audioCtx)return;
  const o=audioCtx.createOscillator(),g=audioCtx.createGain();
  o.connect(g);g.connect(audioCtx.destination);
  o.type='sine';o.frequency.setValueAtTime(600,audioCtx.currentTime);
  o.frequency.exponentialRampToValueAtTime(1200,audioCtx.currentTime+.15);
  g.gain.setValueAtTime(.3,audioCtx.currentTime);
  g.gain.exponentialRampToValueAtTime(.001,audioCtx.currentTime+.3);
  o.start();o.stop(audioCtx.currentTime+.3);
}

// --- BUILD DOG ---
function buildDog(color){
  const g=new THREE.Group();
  // body
  const body=new THREE.Mesh(new THREE.BoxGeometry(1.2,.8,.7),new THREE.MeshLambertMaterial({color}));
  body.position.y=.9;body.castShadow=true;g.add(body);
  // head
  const head=new THREE.Mesh(new THREE.BoxGeometry(.6,.55,.55),new THREE.MeshLambertMaterial({color}));
  head.position.set(0,1.55,.3);head.castShadow=true;g.add(head);
  // snout
  const snout=new THREE.Mesh(new THREE.BoxGeometry(.3,.2,.3),new THREE.MeshLambertMaterial({color:0xfce4c8}));
  snout.position.set(0,1.45,.7);g.add(snout);
  // nose
  const nose=new THREE.Mesh(new THREE.SphereGeometry(.06),new THREE.MeshLambertMaterial({color:0x222222}));
  nose.position.set(0,1.5,.85);g.add(nose);
  // eyes
  for(let s of[-1,1]){
    const eye=new THREE.Mesh(new THREE.SphereGeometry(.06),new THREE.MeshLambertMaterial({color:0x222222}));
    eye.position.set(s*.18,1.62,.55);g.add(eye);
    const w=new THREE.Mesh(new THREE.SphereGeometry(.04),new THREE.MeshLambertMaterial({color:0xffffff}));
    w.position.set(s*.18+.02,1.64,.58);g.add(w);
  }
  // ears
  for(let s of[-1,1]){
    const ear=new THREE.Mesh(new THREE.BoxGeometry(.15,.35,.1),new THREE.MeshLambertMaterial({color}));
    ear.position.set(s*.28,1.9,.25);ear.rotation.z=s*.2;ear.castShadow=true;g.add(ear);
  }
  // legs
  for(let x of[-.35,.35])for(let z of[-.15,.15]){
    const leg=new THREE.Mesh(new THREE.BoxGeometry(.2,.5,.2),new THREE.MeshLambertMaterial({color}));
    leg.position.set(x,.25,z);leg.castShadow=true;g.add(leg);
    leg.userData.isLeg=true;
  }
  // tail
  const tail=new THREE.Mesh(new THREE.CylinderGeometry(.04,.06,.5),new THREE.MeshLambertMaterial({color}));
  tail.position.set(0,1.2,-.55);tail.rotation.x=-.6;g.add(tail);
  g.userData.tail=tail;
  return g;
}

// --- BUILD WORLD ---
function buildTree(x,z){
  const g=new THREE.Group();
  const trunk=new THREE.Mesh(new THREE.CylinderGeometry(.15,.2,2),new THREE.MeshLambertMaterial({color:0x8B6914}));
  trunk.position.y=1;trunk.castShadow=true;g.add(trunk);
  const top=new THREE.Mesh(new THREE.SphereGeometry(1.2,8,6),new THREE.MeshLambertMaterial({color:0x4CAF50}));
  top.position.y=2.8;top.castShadow=true;g.add(top);
  g.position.set(x,0,z);return g;
}
function buildHouse(){
  const g=new THREE.Group();
  const walls=new THREE.Mesh(new THREE.BoxGeometry(6,3.5,5),new THREE.MeshLambertMaterial({color:0xFFF8DC}));
  walls.position.y=1.75;walls.castShadow=true;walls.receiveShadow=true;g.add(walls);
  // roof
  const roofGeo=new THREE.BufferGeometry();
  const v=new Float32Array([-3.3,3.5,-2.8, 3.3,3.5,-2.8, 0,5.5,0, -3.3,3.5,2.8, 3.3,3.5,2.8, 0,5.5,0, -3.3,3.5,-2.8, -3.3,3.5,2.8, 0,5.5,0, 3.3,3.5,-2.8, 3.3,3.5,2.8, 0,5.5,0]);
  roofGeo.setAttribute('position',new THREE.BufferAttribute(v,3));
  roofGeo.computeVertexNormals();
  const roof=new THREE.Mesh(roofGeo,new THREE.MeshLambertMaterial({color:0xC67A3C,side:THREE.DoubleSide}));
  roof.castShadow=true;g.add(roof);
  // door
  const door=new THREE.Mesh(new THREE.BoxGeometry(1,2,.1),new THREE.MeshLambertMaterial({color:0x654321}));
  door.position.set(0,1,2.55);g.add(door);
  // doorknob
  const knob=new THREE.Mesh(new THREE.SphereGeometry(.06),new THREE.MeshLambertMaterial({color:0xDAA520}));
  knob.position.set(.3,1,2.6);g.add(knob);
  // windows
  for(let s of[-1,1]){
    const win=new THREE.Mesh(new THREE.BoxGeometry(1,1,.1),new THREE.MeshLambertMaterial({color:0x88CCFF}));
    win.position.set(s*2,2.2,2.55);g.add(win);
    // frame
    const frame=new THREE.Mesh(new THREE.BoxGeometry(1.15,1.15,.05),new THREE.MeshLambertMaterial({color:0xffffff}));
    frame.position.set(s*2,2.2,2.5);g.add(frame);
  }
  g.position.set(0,0,-18);return g;
}
function buildFence(x,z,rot){
  const g=new THREE.Group();
  for(let i=0;i<5;i++){
    const post=new THREE.Mesh(new THREE.BoxGeometry(.08,1,.08),new THREE.MeshLambertMaterial({color:0xffffff}));
    post.position.set(i*.8-.4*4,.5,0);post.castShadow=true;g.add(post);
    // picket top
    const top=new THREE.Mesh(new THREE.ConeGeometry(.06,.15,4),new THREE.MeshLambertMaterial({color:0xffffff}));
    top.position.set(i*.8-.4*4,1.05,0);g.add(top);
  }
  // rails
  for(let y of[.3,.7]){
    const rail=new THREE.Mesh(new THREE.BoxGeometry(3.5,.06,.06),new THREE.MeshLambertMaterial({color:0xffffff}));
    rail.position.y=y;g.add(rail);
  }
  g.position.set(x,0,z);g.rotation.y=rot||0;return g;
}
function buildFlower(x,z){
  const colors=[0xFF6B9D,0xFF4B0F,0xFDC145,0xE8734A,0xFF69B4,0xFF1493];
  const g=new THREE.Group();
  const stem=new THREE.Mesh(new THREE.CylinderGeometry(.02,.02,.4),new THREE.MeshLambertMaterial({color:0x389810}));
  stem.position.set(x,.2,z);g.add(stem);
  const col=colors[Math.floor(Math.random()*colors.length)];
  const bloom=new THREE.Mesh(new THREE.SphereGeometry(.1,6,6),new THREE.MeshLambertMaterial({color:col}));
  bloom.position.set(x,.45,z);g.add(bloom);
  return g;
}
function buildBush(x,z){
  const b=new THREE.Mesh(new THREE.SphereGeometry(.7,8,6),new THREE.MeshLambertMaterial({color:0x2E8B2E}));
  b.position.set(x,.3,z);b.castShadow=true;return b;
}
function buildBone(x,z){
  const g=new THREE.Group();
  const shaft=new THREE.Mesh(new THREE.CylinderGeometry(.06,.06,.5,8),new THREE.MeshLambertMaterial({color:0xF5A623,emissive:0x553600,emissiveIntensity:.2}));
  shaft.rotation.z=Math.PI/2;g.add(shaft);
  for(let s of[-1,1])for(let d of[-1,1]){
    const knob=new THREE.Mesh(new THREE.SphereGeometry(.09,8,8),new THREE.MeshLambertMaterial({color:0xF5A623,emissive:0x553600,emissiveIntensity:.2}));
    knob.position.set(s*.3,d*.07,0);g.add(knob);
  }
  g.position.set(x,.7,z);g.userData.baseY=.7;g.userData.collected=false;g.userData.anim=0;
  return g;
}

// --- BINGO AI ---
let bingoTarget=null,bingoWait=0;
function updateBingo(dt){
  if(!bingo)return;
  if(bingoWait>0){bingoWait-=dt;
    // idle tail wag
    bingo.userData.tail.rotation.z=Math.sin(clock.elapsedTime*5)*.3;
    return;
  }
  if(!bingoTarget||bingo.position.distanceTo(bingoTarget)<.5){
    bingoTarget=new THREE.Vector3((Math.random()-.5)*30,.0,(Math.random()-.5)*30);
    bingoWait=1+Math.random()*3;return;
  }
  const dir=bingoTarget.clone().sub(bingo.position).normalize();
  bingo.position.x+=dir.x*SPEED*.4*dt;
  bingo.position.z+=dir.z*SPEED*.4*dt;
  bingo.rotation.y=Math.atan2(dir.x,dir.z);
  // walk animation
  const legs=bingo.children.filter(c=>c.userData.isLeg);
  legs.forEach((l,i)=>{l.rotation.x=Math.sin(clock.elapsedTime*8+i*Math.PI*.5)*.3});
  bingo.userData.tail.rotation.z=Math.sin(clock.elapsedTime*6)*.4;
  // bounce
  bingo.position.y=Math.abs(Math.sin(clock.elapsedTime*8))*.08;
}

// --- INIT ---
function init(){
  scene=new THREE.Scene();
  scene.background=new THREE.Color(0x87CEEB);
  scene.fog=new THREE.Fog(0x87CEEB,40,70);
  clock=new THREE.Clock();

  camera=new THREE.PerspectiveCamera(55,innerWidth/innerHeight,.1,200);
  camera.position.set(0,6,-8);

  renderer=new THREE.WebGLRenderer({antialias:true});
  renderer.setSize(innerWidth,innerHeight);
  renderer.setPixelRatio(Math.min(devicePixelRatio,2));
  renderer.shadowMap.enabled=true;
  renderer.shadowMap.type=THREE.PCFSoftShadowMap;
  document.body.appendChild(renderer.domElement);

  // lights
  const amb=new THREE.AmbientLight(0xffffff,.5);scene.add(amb);
  const sun=new THREE.DirectionalLight(0xFFF5E0,1);
  sun.position.set(10,15,10);sun.castShadow=true;
  sun.shadow.mapSize.set(2048,2048);
  sun.shadow.camera.left=-30;sun.shadow.camera.right=30;
  sun.shadow.camera.top=30;sun.shadow.camera.bottom=-30;
  scene.add(sun);
  // warm fill
  const fill=new THREE.DirectionalLight(0xFFE0B2,.3);
  fill.position.set(-5,5,-5);scene.add(fill);

  // ground
  const ground=new THREE.Mesh(new THREE.PlaneGeometry(60,60),new THREE.MeshLambertMaterial({color:0x7EC850}));
  ground.rotation.x=-Math.PI/2;ground.receiveShadow=true;scene.add(ground);

  // player
  player=buildDog(0x4A90D9);player.position.set(0,0,5);scene.add(player);

  // bingo
  bingo=buildDog(0xE8734A);bingo.position.set(5,0,3);scene.add(bingo);

  // house
  scene.add(buildHouse());

  // trees
  const treePos=[[-10,0,-8],[12,0,-5],[-8,0,8],[15,0,12],[-14,0,-14],[18,0,-12],[-5,0,15],[20,0,5]];
  treePos.forEach(p=>scene.add(buildTree(p[0],p[2])));

  // fences
  for(let i=0;i<4;i++)scene.add(buildFence(-12+i*4,0,-13,0));
  for(let i=0;i<3;i++)scene.add(buildFence(8,0,-13+i*4,Math.PI/2));

  // flowers
  for(let i=0;i<40;i++){
    const x=(Math.random()-.5)*45,z=(Math.random()-.5)*45;
    scene.add(buildFlower(x,z));
  }

  // bushes
  [[-6,0,10],[8,0,-10],[-12,0,5],[14,0,8],[-3,0,-8]].forEach(p=>scene.add(buildBush(p[0],p[2])));

  // bones
  for(let i=0;i<totalBones;i++){
    const x=(Math.random()-.5)*40,z=(Math.random()-.5)*40;
    const b=buildBone(x,z);scene.add(b);bones.push(b);
  }

  // clouds
  for(let i=0;i<8;i++){
    const c=new THREE.Mesh(new THREE.SphereGeometry(1+Math.random()*2,8,6),new THREE.MeshLambertMaterial({color:0xffffff,transparent:true,opacity:.8}));
    c.position.set((Math.random()-.5)*60,12+Math.random()*5,(Math.random()-.5)*60);
    c.scale.set(1+Math.random(),.5+Math.random()*.3,1+Math.random());
    c.userData.cloud=true;c.userData.speed=.2+Math.random()*.3;
    scene.add(c);
  }

  // input - mouse/touch steers, character auto-moves forward
  let mouseX=innerWidth/2;
  addEventListener('mousemove',e=>{mouseX=e.clientX});
  addEventListener('keydown',e=>{keys[e.code]=true;if(e.code==='Space')e.preventDefault()});
  addEventListener('keyup',e=>{keys[e.code]=false});
  addEventListener('resize',()=>{camera.aspect=innerWidth/innerHeight;camera.updateProjectionMatrix();renderer.setSize(innerWidth,innerHeight)});

  // touch - tap left/right half to steer, character always moves forward
  let touchSteer=0;
  addEventListener('touchstart',e=>{
    const x=e.touches[0].clientX;
    touchSteer=x<innerWidth/2?-1:1;
  },{passive:true});
  addEventListener('touchmove',e=>{
    const x=e.touches[0].clientX;
    touchSteer=x<innerWidth/2?-1:1;
  },{passive:true});
  addEventListener('touchend',()=>{touchSteer=0},{passive:true});

  document.getElementById('total').textContent=totalBones;
}

// --- GAME LOOP ---
function animate(){
  requestAnimationFrame(animate);
  const dt=Math.min(clock.getDelta(),.05);
  if(!gameStarted){renderer.render(scene,camera);return}

  // player movement - auto-forward, mouse/touch steers
  const TURN=2.5;
  // mouse steering: left side of screen = turn left, right = turn right
  const screenCenter=innerWidth/2;
  const mouseDelta=(mouseX-screenCenter)/screenCenter; // -1 to 1
  let steer=mouseDelta+touchSteer;
  // keyboard can also steer
  if(keys['ArrowLeft']||keys['KeyA'])steer-=1;
  if(keys['ArrowRight']||keys['KeyD'])steer+=1;
  steer=Math.max(-1,Math.min(1,steer));

  player.rotation.y-=steer*TURN*dt;
  // always move forward
  player.position.x+=Math.sin(player.rotation.y)*SPEED*dt;
  player.position.z+=Math.cos(player.rotation.y)*SPEED*dt;
  const moving=true;
  // walk anim
  const legs=player.children.filter(c=>c.userData.isLeg);
  legs.forEach((l,i)=>{l.rotation.x=Math.sin(clock.elapsedTime*10+i*Math.PI*.5)*.4});
  player.userData.tail.rotation.z=Math.sin(clock.elapsedTime*8)*.5;

  // jump
  if((keys['Space']||touchJump)&&onGround){velY=JUMP;onGround=false;touchJump=false}
  velY-=GRAV*dt;
  player.position.y+=velY*dt;
  if(player.position.y<=0){player.position.y=0;velY=0;onGround=true}

  // bounce when moving on ground (not while jumping)
  if(onGround&&velY<=0)player.position.y=Math.abs(Math.sin(clock.elapsedTime*10))*.1;

  // boundary - wrap around
  if(player.position.x>BOUND)player.position.x=-BOUND;
  if(player.position.x<-BOUND)player.position.x=BOUND;
  if(player.position.z>BOUND)player.position.z=-BOUND;
  if(player.position.z<-BOUND)player.position.z=BOUND;

  // bingo
  updateBingo(dt);

  // bones animation + collection
  bones.forEach(b=>{
    if(b.userData.collected)return;
    b.rotation.y+=dt*2;
    b.position.y=b.userData.baseY+Math.sin(clock.elapsedTime*3+b.position.x)*.15;
    // collect check
    const dx=player.position.x-b.position.x,dz=player.position.z-b.position.z;
    if(Math.sqrt(dx*dx+dz*dz)<1.5){
      b.userData.collected=true;collected++;
      document.getElementById('score').textContent=collected;
      playDing();
      // animate out
      const start=clock.elapsedTime;
      const doAnim=()=>{
        const t=clock.elapsedTime-start;
        if(t<.3){
          const s=1+t*3;b.scale.set(s,s,s);
          b.children.forEach(c=>{if(c.material)c.material.transparent=true;c.material&&(c.material.opacity=1-t/0.3)});
          requestAnimationFrame(doAnim);
        } else {b.visible=false}
      };doAnim();
      // all collected?
      if(collected>=totalBones){
        const m=document.getElementById('msg');m.textContent='Amazing! \u{1F9B4}';m.classList.add('show');
        setTimeout(()=>{m.classList.remove('show');respawnBones()},3000);
      }
    }
  });

  // clouds
  scene.children.forEach(c=>{if(c.userData.cloud){c.position.x+=c.userData.speed*dt;if(c.position.x>35)c.position.x=-35}});

  // camera
  const ideal=new THREE.Vector3(0,4,-6).applyQuaternion(player.quaternion).add(player.position);
  camera.position.lerp(ideal,3*dt);
  const look=player.position.clone();look.y+=1.2;
  camera.lookAt(look);

  renderer.render(scene,camera);
}

function respawnBones(){
  collected=0;document.getElementById('score').textContent=0;
  bones.forEach(b=>{
    b.visible=true;b.userData.collected=false;b.scale.set(1,1,1);
    b.children.forEach(c=>{if(c.material){c.material.transparent=false;c.material.opacity=1}});
    b.position.x=(Math.random()-.5)*40;b.position.z=(Math.random()-.5)*40;
    b.userData.baseY=.7;b.position.y=.7;
  });
}

function startGame(){
  initAudio();gameStarted=true;
  document.getElementById('title').classList.add('hidden');
  document.getElementById('hud').classList.remove('hidden');
}

init();animate();
</script>
</body>
</html>